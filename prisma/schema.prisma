// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  INSTRUCTOR
  MENTOR
  STUDENT
}

model User {
  id       String  @id @default(uuid())
  name     String?
  username String? @unique
  email    String? @unique
  image    String?
  password String?
  mobile   String?
  role     Role    @default(STUDENT)

  lastLogin     DateTime[]
  emailVerified DateTime?

  oneTimePassword String @default(uuid())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  account         Account[]
  course          Course[]
  enrolledUsers   EnrolledUsers[]
  profile         Profile?
  doubt           Doubt[]
  response        Response[]
  assignedMentors AssignedMentors[]
  Attendence      Attendance[]
}

model Profile {
  id     Int    @id @default(autoincrement())
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  section      String?
  branch       String?
  academicYear String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Course {
  id            String          @id @default(uuid())
  createdById   String
  createdBy     User            @relation(fields: [createdById], references: [id])
  title         String
  image         String?
  enrolledUsers EnrolledUsers[]
  classes       Class[]
  attachments   Attachment[]
  doubts        Doubt[]

  startDate DateTime  @default(now())
  endDate   DateTime?

  isPublished Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EnrolledUsers {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  assignedMentors AssignedMentors[]

  startDate DateTime  @default(now())
  endDate   DateTime?

  courseId String?
  course   Course? @relation(fields: [courseId], references: [id])

  submission submission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, courseId])
}

model AssignedMentors {
  id String @id @default(uuid())

  mentorId String
  mentor   User   @relation(fields: [mentorId], references: [id])

  enrolledUserId String
  enrolledUser   EnrolledUsers @relation(fields: [enrolledUserId], references: [id])

  startDate DateTime  @default(now())
  endDate   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([mentorId, enrolledUserId])
}

model Class {
  id          String       @id @default(uuid())
  title       String       @default("class")
  video       Video        @relation(fields: [videoId], references: [id])
  attachments Attachment[]
  courseId    String?
  course      Course?      @relation(fields: [courseId], references: [id])
  videoId     String
  Attendence  Attendance[]

  folderId  String?
  Folder    Folder?  @relation(fields: [folderId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Folder {
  id    String  @id @default(uuid())
  title String  @default("Folder")
  Class Class[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Attendance {
  id String @id @default(uuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [username])

  classId String
  class   Class  @relation(fields: [classId], references: [id])

  attendedDuration Int?
  attended         Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Doubt {
  id          String     @id @default(uuid())
  title       String?
  description String?
  user        User       @relation(fields: [userId], references: [id])
  userId      String
  courseId    String?
  course      Course?    @relation(fields: [courseId], references: [id])
  response    Response[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Response {
  id          String  @id @default(uuid())
  description String?
  user        User    @relation(fields: [userId], references: [id])
  userId      String
  doubt       Doubt   @relation(fields: [doubtId], references: [id], onDelete: Cascade)
  doubtId     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum VideoType {
  DRIVE
  YOUTUBE
  ZOOM
}

model Video {
  id         String    @id @default(uuid())
  videoLink  String?
  videoType  VideoType
  timeStamps Json?
  class      Class[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum attachmentType {
  ASSIGNMENT
  GITHUB
  ZOOM
  OTHERS
}

model Attachment {
  id             String         @id @default(uuid())
  title          String         @default("Attachment")
  details        String?
  attachmentType attachmentType
  link           String?
  submissions    submission[]
  classId        String?
  class          Class?         @relation(fields: [classId], references: [id])
  courseId       String?
  course         Course?        @relation(fields: [courseId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  dueDate   DateTime?
}

model submission {
  id             String        @id @default(uuid())
  enrolledUserId String
  enrolledUser   EnrolledUsers @relation(fields: [enrolledUserId], references: [id])

  attachmentId String
  assignment   Attachment @relation(fields: [attachmentId], references: [id])

  points Point[]

  overallFeedback String?

  submissionLink String?
  submissionDate DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum pointCategory {
  RESPOSIVENESS
  STYLING
  OTHER
}

model Point {
  id           String        @id @default(uuid())
  category     pointCategory
  feedback     String?
  score        Int           @default(0)
  submissions  submission?   @relation(fields: [submissionId], references: [id])
  submissionId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([submissionId, category])
}

model Account {
  id                String  @id @default(uuid())
  type              String
  provider          String
  providerAccountId String
  token_type        String?
  refresh_token     String?
  access_token      String?
  id_token          String?
  scope             String?
  session_state     String?
  expires_at        Int?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique

  @@unique([provider, providerAccountId])
}
