---
import RootLayout from '@/layouts/RootLayout.astro';
import { actions } from 'astro:actions';
import { Course } from '@prisma/client';
import Report,{DataItem} from './_components/Report.tsx';

const { courseId } = Astro.params;

const call = Astro.callAction
if (!courseId) {
    return Astro.redirect('/instructor/courses', 302);
}

const {data} = await call(actions.report_generateReport,{courseId})
const report = data?.data
const sortedData = report ? [...report].sort((a, b) => 
    a.username.localeCompare(b.username)
) : [];
const {data:coursesData} = await call(actions.courses_getAllCourses,{})
const courses = coursesData?.data
---

<RootLayout title="Report">
    <Report 
        initialdata={sortedData as DataItem[]} 
        allCourses={courses as Course[]} 
        courseId={courseId} 
    />
</RootLayout>